<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Migrating to Fastlane (Part 1) | andysaw</title><meta name=keywords content="ios,fastlane"><meta name=description content="App releases, app distribution and general day-to-day development is full of laborious, manual tasks that squander our time. For iOS developers, Fastlane is an invaluable tool that can help automate away most of this.
It&rsquo;s fantastically easy to integrate into your workflow - that is, unless you find yourself with an app that has already seen multiple, manually-performed releases. I found myself in said situation recently, banging my head in frustration at the lack of documentation regarding this."><meta name=author content><link rel=canonical href=https://andyksaw.github.io/posts/migrate_to_fastlane_part_1/><link crossorigin=anonymous href=/assets/css/stylesheet.min.34f610da9fa2cd806ab9ff3f025f84f8f50c190cfbe3eb63b50b7d092bd7afdf.css integrity="sha256-NPYQ2p+izYBquf8/Al+E+PUMGQz74+tjtQt9CSvXr98=" rel="preload stylesheet" as=style><link rel=icon href=https://andyksaw.github.io/favicon.ico><link rel=apple-touch-icon href=https://andyksaw.github.io/apple-touch-icon.png><meta name=twitter:title content="Migrating to Fastlane (Part 1) | andysaw"><meta name=twitter:description content="App releases, app distribution and general day-to-day development is full of laborious, manual tasks that squander our time. For iOS developers, Fastlane is an invaluable tool that can help automate away most of this.
It&rsquo;s fantastically easy to integrate into your workflow - that is, unless you find yourself with an app that has already seen multiple, manually-performed releases. I found myself in said situation recently, banging my head in frustration at the lack of documentation regarding this."><meta property="og:title" content="Migrating to Fastlane (Part 1) | andysaw"><meta property="og:description" content="App releases, app distribution and general day-to-day development is full of laborious, manual tasks that squander our time. For iOS developers, Fastlane is an invaluable tool that can help automate away most of this.
It&rsquo;s fantastically easy to integrate into your workflow - that is, unless you find yourself with an app that has already seen multiple, manually-performed releases. I found myself in said situation recently, banging my head in frustration at the lack of documentation regarding this."><meta property="og:type" content="article"><meta property="og:url" content="https://andyksaw.github.io/posts/migrate_to_fastlane_part_1/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-06T23:00:26+09:00"><meta property="article:modified_time" content="2022-01-06T23:00:26+09:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://andyksaw.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Migrating to Fastlane (Part 1)","item":"https://andyksaw.github.io/posts/migrate_to_fastlane_part_1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Migrating to Fastlane (Part 1) | andysaw","name":"Migrating to Fastlane (Part 1)","description":"App releases, app distribution and general day-to-day development is full of laborious, manual tasks that squander our time. For iOS developers, Fastlane is an invaluable tool that can help automate away most of this.\nIt\u0026rsquo;s fantastically easy to integrate into your workflow - that is, unless you find yourself with an app that has already seen multiple, manually-performed releases. I found myself in said situation recently, banging my head in frustration at the lack of documentation regarding this.","keywords":["ios","fastlane"],"wordCount":"517","inLanguage":"en","datePublished":"2022-01-06T23:00:26+09:00","dateModified":"2022-01-06T23:00:26+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://andyksaw.github.io/posts/migrate_to_fastlane_part_1/"},"publisher":{"@type":"Organization","name":"andysaw","logo":{"@type":"ImageObject","url":"https://andyksaw.github.io/favicon.ico"}}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-2747125-3"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-2747125-3")</script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list-page{background:var(--theme)}.list-page:not(.dark)::-webkit-scrollbar-track{background:0 0}.list-page:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body class="type-posts kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="light",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=https://andyksaw.github.io accesskey=h title="andysaw (Alt + H)">andysaw</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://andyksaw.github.io/categories/ title=categories>categories</a></li><li><a href=https://andyksaw.github.io/tags/ title=tags>tags</a></li><li><a href=https://andyksaw.github.io/search/ title="search (Alt + /)" data-no-instant accesskey=/>search</a></li><li><a href=https://andyksaw.github.io/archives/ title=archive>archive</a></li></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><h1 class=post-title>Migrating to Fastlane (Part 1)</h1><div class=post-meta><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>January 6, 2022</span></span><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<span class=post-tags><a href=https://andyksaw.github.io/tags/ios/>ios</a><a href=https://andyksaw.github.io/tags/fastlane/>fastlane</a></span></span><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>3 min</span></span></div></header><div class="toc side right"><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><ul><li><a href=#the-roadmap aria-label="The Roadmap">The Roadmap</a></li></ul><li><a href=#part-1---app-store-connect-key aria-label="Part 1 - App Store Connect Key">Part 1 - App Store Connect Key</a><ul><li><a href=#credentials-the-old-way aria-label="Credentials: The Old Way">Credentials: The Old Way</a></li><li><a href=#private-key-the-better-way aria-label="Private Key: The Better Way">Private Key: The Better Way</a></li></ul></li></ul></div></details></div><div class=post-content><p>App releases, app distribution and general day-to-day development is full of laborious, manual tasks that squander our time. For iOS developers, Fastlane is an invaluable tool that can help automate away most of this.</p><p>It&rsquo;s fantastically easy to integrate into your workflow - that is, unless you find yourself with an app that has already seen multiple, manually-performed releases. I found myself in said situation recently, banging my head in frustration at the lack of documentation regarding this. Fastlane is simple if you add it in from the beginning (and most guides assume you&rsquo;ll be doing so), but full of gotchas and landmines later if you don&rsquo;t.</p><p>This series of posts outlines the process I went through and the various caveats I discovered along the way. By the end of it, we&rsquo;ll have an automated app-release pipeline that we can be proud of.</p><h2 id=the-roadmap>The Roadmap<a hidden class=anchor aria-hidden=true href=#the-roadmap>¬∂</a></h2><ul><li>Part 1 - App Store Connect API Key for authentication</li><li>Part 2 - Storing certificates/profiles in a GCP Bucket</li><li>Part 3 - Reusing existing certificates, profiles and keys</li><li>Part 4 - Migrating to manual app signing</li><li>Part 5 - Provisioning Profile device list</li><li>Part 6 - Uploading to TestFlight</li></ul><h1 id=part-1---app-store-connect-key>Part 1 - App Store Connect Key<a hidden class=anchor aria-hidden=true href=#part-1---app-store-connect-key>¬∂</a></h1><p>We&rsquo;ll start off with the lowest hanging fruit: switching our authentication to using an API token.</p><p>Any operation performed by Fastlane that involves the App Store (eg. submitting to TestFlight, releasing the app) or certificates/profiles (eg. downloading, updating, etc) hits an App Store Connect API under the hood. For obvious reasons, these operations all require authentication to prove that you are allowed to do so.</p><h2 id=credentials-the-old-way>Credentials: The Old Way<a hidden class=anchor aria-hidden=true href=#credentials-the-old-way>¬∂</a></h2><p>If you&rsquo;ve been releasing an app manually, you would ordinarily log-in to App Store Connect with your email address and password in the browser.</p><p>Fastlane uses this as the default form of authentication, and it is <strong>not recommended due to enforced Multi Factor Authentication</strong>. In other words, the app owner&rsquo;s account must have (Apple&rsquo;s) 2FA enabled, and therefore it will be linked to devices of that account. If you are not said person and need to release the app (manually or via Fastlane), you will need to pester said person often for a generated 2FA code.</p><p>For the same reason, CI/CD will not be possible if you use this way, as it&rsquo;s infeasible to input an always-changing code on every job.</p><p>Frustrating? Yes. Let&rsquo;s fix that first for our sanity.</p><h2 id=private-key-the-better-way>Private Key: The Better Way<a hidden class=anchor aria-hidden=true href=#private-key-the-better-way>¬∂</a></h2><p>A key on the other hand will not prompt you for a 2FA code. As with any API token, you must take care who has it, as it grants the holder the ability to hit the APIs.</p><p>A token can be generated on App Store Connect.</p><p>WIP</p><blockquote><p>‚ö†Ô∏è Your account must have the <strong>Admin</strong> role to generate a token (or even see a link to the page). The <strong>App Owner</strong> role is not sufficient.</p></blockquote><blockquote><p>ü§Ø App Store Connect occasionally has weird caching issues. If your role was just updated to Admin but you still don&rsquo;t see the tab to create the token, try logout of App Store Connect and restart the browser.</p></blockquote></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://andyksaw.github.io>andysaw</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n=""=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script>
<script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>(function(){const a="1"=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script></body></html>