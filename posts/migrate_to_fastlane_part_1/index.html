<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Migrating to Fastlane (Part 1) | andysaw</title><meta name=keywords content="ios,fastlane"><meta name=description content="App releases, app distribution and general day-to-day development is full of laborious, manual tasks that squander our time. For iOS developers, Fastlane is an invaluable tool that can help automate away most of this.
It&rsquo;s fantastically easy to integrate into your workflow - that is, unless you find yourself with an app that has already seen multiple, manually-performed releases. I found myself in said situation recently, banging my head in frustration at the lack of documentation regarding this."><meta name=author content><link rel=canonical href=https://andyksaw.github.io/posts/migrate_to_fastlane_part_1/><link crossorigin=anonymous href=/assets/css/stylesheet.9c4f5aa85dab72ee82fc33b8dfb12a3f7459e6c1b389f9fae73095efa3ecb4d6.css integrity="sha256-nE9aqF2rcu6C/DO437EqP3RZ5sGzifn65zCV76PstNY=" rel="preload stylesheet" as=style><link rel=icon href=https://andyksaw.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://andyksaw.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://andyksaw.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://andyksaw.github.io/apple-touch-icon.png><link rel=mask-icon href=https://andyksaw.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Migrating to Fastlane (Part 1)"><meta property="og:description" content="App releases, app distribution and general day-to-day development is full of laborious, manual tasks that squander our time. For iOS developers, Fastlane is an invaluable tool that can help automate away most of this.
It&rsquo;s fantastically easy to integrate into your workflow - that is, unless you find yourself with an app that has already seen multiple, manually-performed releases. I found myself in said situation recently, banging my head in frustration at the lack of documentation regarding this."><meta property="og:type" content="article"><meta property="og:url" content="https://andyksaw.github.io/posts/migrate_to_fastlane_part_1/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-06T23:00:26+09:00"><meta property="article:modified_time" content="2022-01-06T23:00:26+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Migrating to Fastlane (Part 1)"><meta name=twitter:description content="App releases, app distribution and general day-to-day development is full of laborious, manual tasks that squander our time. For iOS developers, Fastlane is an invaluable tool that can help automate away most of this.
It&rsquo;s fantastically easy to integrate into your workflow - that is, unless you find yourself with an app that has already seen multiple, manually-performed releases. I found myself in said situation recently, banging my head in frustration at the lack of documentation regarding this."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://andyksaw.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Migrating to Fastlane (Part 1)","item":"https://andyksaw.github.io/posts/migrate_to_fastlane_part_1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Migrating to Fastlane (Part 1)","name":"Migrating to Fastlane (Part 1)","description":"App releases, app distribution and general day-to-day development is full of laborious, manual tasks that squander our time. For iOS developers, Fastlane is an invaluable tool that can help automate away most of this.\nIt\u0026rsquo;s fantastically easy to integrate into your workflow - that is, unless you find yourself with an app that has already seen multiple, manually-performed releases. I found myself in said situation recently, banging my head in frustration at the lack of documentation regarding this.","keywords":["ios","fastlane"],"articleBody":"App releases, app distribution and general day-to-day development is full of laborious, manual tasks that squander our time. For iOS developers, Fastlane is an invaluable tool that can help automate away most of this.\nIt‚Äôs fantastically easy to integrate into your workflow - that is, unless you find yourself with an app that has already seen multiple, manually-performed releases. I found myself in said situation recently, banging my head in frustration at the lack of documentation regarding this. Fastlane is simple if you add it in from the beginning (and most guides assume you‚Äôll be doing so), but full of gotchas and landmines later if you don‚Äôt.\nThis series of posts outlines the process I went through and the various caveats I discovered along the way. By the end of it, we‚Äôll have an automated app-release pipeline that we can be proud of. ap\nPart 1 - App Store Connect API Key for authentication Part 2 - Storing certificates/profiles in a GCP Bucket Part 3 - Reusing existing certificates, profiles and keys Part 4 - Migrating to manual app signing Part 5 - Provisioning Profile device list Part 6 - Uploading to TestFlight Part 1 - App Store Connect Key We‚Äôll start off with the lowest hanging fruit: switching our authentication to using an API token.\nAny operation performed by Fastlane that involves the App Store (eg. submitting to TestFlight, releasing the app) or certificates/profiles (eg. downloading, updating, etc) hits an App Store Connect API under the hood. For obvious reasons, these operations all require authentication to prove that you are allowed to do so.\nCredentials: The Old Way If you‚Äôve been releasing an app manually, you would ordinarily log-in to App Store Connect with your email address and password in the browser.\nFastlane uses this as the default form of authentication, and it is not recommended due to enforced Multi Factor Authentication. In other words, the app owner‚Äôs account must have (Apple‚Äôs) 2FA enabled, and therefore it will be linked to devices of that account. If you are not said person and need to release the app (manually or via Fastlane), you will need to pester said person often for a generated 2FA code.\nFor the same reason, CI/CD will not be possible if you use this way, as it‚Äôs infeasible to input an always-changing code on every job.\nFrustrating? Yes. Let‚Äôs fix that first for our sanity.\nPrivate Key: The Better Way A key on the other hand will not prompt you for a 2FA code. As with any API token, you must take care who has it, as it grants the holder the ability to hit the APIs.\nA token can be generated on App Store Connect.\nWIP\n‚ö†Ô∏è Your account must have the Admin role to generate a token (or even see a link to the page). The App Owner role is not sufficient.\nü§Ø App Store Connect occasionally has weird caching issues. If your role was just updated to Admin but you still don‚Äôt see the tab to create the token, try logout of App Store Connect and restart the browser.\n","wordCount":"516","inLanguage":"en","datePublished":"2022-01-06T23:00:26+09:00","dateModified":"2022-01-06T23:00:26+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://andyksaw.github.io/posts/migrate_to_fastlane_part_1/"},"publisher":{"@type":"Organization","name":"andysaw","logo":{"@type":"ImageObject","url":"https://andyksaw.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://andyksaw.github.io accesskey=h title="andysaw (Alt + H)">andysaw</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://andyksaw.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://andyksaw.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://andyksaw.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://andyksaw.github.io/archives/ title=archive><span>archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Migrating to Fastlane (Part 1)</h1><div class=post-meta><span title='2022-01-06 23:00:26 +0900 +0900'>January 6, 2022</span>&nbsp;¬∑&nbsp;3 min</div></header><div class=post-content><p>App releases, app distribution and general day-to-day development is full of laborious, manual tasks that squander our time. For iOS developers, Fastlane is an invaluable tool that can help automate away most of this.</p><p>It&rsquo;s fantastically easy to integrate into your workflow - that is, unless you find yourself with an app that has already seen multiple, manually-performed releases. I found myself in said situation recently, banging my head in frustration at the lack of documentation regarding this. Fastlane is simple if you add it in from the beginning (and most guides assume you&rsquo;ll be doing so), but full of gotchas and landmines later if you don&rsquo;t.</p><p>This series of posts outlines the process I went through and the various caveats I discovered along the way. By the end of it, we&rsquo;ll have an automated app-release pipeline that we can be proud of.
ap</p><ul><li>Part 1 - App Store Connect API Key for authentication</li><li>Part 2 - Storing certificates/profiles in a GCP Bucket</li><li>Part 3 - Reusing existing certificates, profiles and keys</li><li>Part 4 - Migrating to manual app signing</li><li>Part 5 - Provisioning Profile device list</li><li>Part 6 - Uploading to TestFlight</li></ul><h1 id=part-1---app-store-connect-key>Part 1 - App Store Connect Key<a hidden class=anchor aria-hidden=true href=#part-1---app-store-connect-key>#</a></h1><p>We&rsquo;ll start off with the lowest hanging fruit: switching our authentication to using an API token.</p><p>Any operation performed by Fastlane that involves the App Store (eg. submitting to TestFlight, releasing the app) or certificates/profiles (eg. downloading, updating, etc) hits an App Store Connect API under the hood. For obvious reasons, these operations all require authentication to prove that you are allowed to do so.</p><h2 id=credentials-the-old-way>Credentials: The Old Way<a hidden class=anchor aria-hidden=true href=#credentials-the-old-way>#</a></h2><p>If you&rsquo;ve been releasing an app manually, you would ordinarily log-in to App Store Connect with your email address and password in the browser.</p><p>Fastlane uses this as the default form of authentication, and it is <strong>not recommended due to enforced Multi Factor Authentication</strong>. In other words, the app owner&rsquo;s account must have (Apple&rsquo;s) 2FA enabled, and therefore it will be linked to devices of that account. If you are not said person and need to release the app (manually or via Fastlane), you will need to pester said person often for a generated 2FA code.</p><p>For the same reason, CI/CD will not be possible if you use this way, as it&rsquo;s infeasible to input an always-changing code on every job.</p><p>Frustrating? Yes. Let&rsquo;s fix that first for our sanity.</p><h2 id=private-key-the-better-way>Private Key: The Better Way<a hidden class=anchor aria-hidden=true href=#private-key-the-better-way>#</a></h2><p>A key on the other hand will not prompt you for a 2FA code. As with any API token, you must take care who has it, as it grants the holder the ability to hit the APIs.</p><p>A token can be generated on App Store Connect.</p><p>WIP</p><blockquote><p>‚ö†Ô∏è Your account must have the <strong>Admin</strong> role to generate a token (or even see a link to the page). The <strong>App Owner</strong> role is not sufficient.</p></blockquote><blockquote><p>ü§Ø App Store Connect occasionally has weird caching issues. If your role was just updated to Admin but you still don&rsquo;t see the tab to create the token, try logout of App Store Connect and restart the browser.</p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://andyksaw.github.io/tags/ios/>ios</a></li><li><a href=https://andyksaw.github.io/tags/fastlane/>fastlane</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://andyksaw.github.io>andysaw</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>