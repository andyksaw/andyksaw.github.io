<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Migrating to Fastlane (Part 1) | andysaw</title><meta name=keywords content="ios,fastlane,app store connect,api key"><meta name=description content="App releases, app distribution and general day-to-day development is full of laborious, manual tasks that squander our time. For iOS developers, Fastlane is an invaluable tool that can help automate away most of this.
It&rsquo;s super easy to integrate into your workflow - that is, unless you find yourself with an app that has already seen multiple, manually-performed releases. I found myself in said situation recently, banging my head in frustration at the lack of documentation regarding this."><meta name=author content><link rel=canonical href=https://andyksaw.github.io/posts/migrate-to-fastlane/part-1-api-key/><link crossorigin=anonymous href=/assets/css/stylesheet.min.34f610da9fa2cd806ab9ff3f025f84f8f50c190cfbe3eb63b50b7d092bd7afdf.css integrity="sha256-NPYQ2p+izYBquf8/Al+E+PUMGQz74+tjtQt9CSvXr98=" rel="preload stylesheet" as=style><link rel=icon href=https://andyksaw.github.io/favicon.ico><link rel=apple-touch-icon href=https://andyksaw.github.io/apple-touch-icon.png><meta name=twitter:title content="Migrating to Fastlane (Part 1) | andysaw"><meta name=twitter:description content="App releases, app distribution and general day-to-day development is full of laborious, manual tasks that squander our time. For iOS developers, Fastlane is an invaluable tool that can help automate away most of this.
It&rsquo;s super easy to integrate into your workflow - that is, unless you find yourself with an app that has already seen multiple, manually-performed releases. I found myself in said situation recently, banging my head in frustration at the lack of documentation regarding this."><meta property="og:title" content="Migrating to Fastlane (Part 1) | andysaw"><meta property="og:description" content="App releases, app distribution and general day-to-day development is full of laborious, manual tasks that squander our time. For iOS developers, Fastlane is an invaluable tool that can help automate away most of this.
It&rsquo;s super easy to integrate into your workflow - that is, unless you find yourself with an app that has already seen multiple, manually-performed releases. I found myself in said situation recently, banging my head in frustration at the lack of documentation regarding this."><meta property="og:type" content="article"><meta property="og:url" content="https://andyksaw.github.io/posts/migrate-to-fastlane/part-1-api-key/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-06T23:00:26+09:00"><meta property="article:modified_time" content="2022-01-06T23:00:26+09:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://andyksaw.github.io/posts/"},{"@type":"ListItem","position":3,"name":"","item":"https://andyksaw.github.io/posts/migrate-to-fastlane/"},{"@type":"ListItem","position":4,"name":"Migrating to Fastlane (Part 1)","item":"https://andyksaw.github.io/posts/migrate-to-fastlane/part-1-api-key/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Migrating to Fastlane (Part 1) | andysaw","name":"Migrating to Fastlane (Part 1)","description":"App releases, app distribution and general day-to-day development is full of laborious, manual tasks that squander our time. For iOS developers, Fastlane is an invaluable tool that can help automate away most of this.\nIt\u0026rsquo;s super easy to integrate into your workflow - that is, unless you find yourself with an app that has already seen multiple, manually-performed releases. I found myself in said situation recently, banging my head in frustration at the lack of documentation regarding this.","keywords":["ios","fastlane","app store connect","api key"],"wordCount":"1061","inLanguage":"en","datePublished":"2022-01-06T23:00:26+09:00","dateModified":"2022-01-06T23:00:26+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://andyksaw.github.io/posts/migrate-to-fastlane/part-1-api-key/"},"publisher":{"@type":"Organization","name":"andysaw","logo":{"@type":"ImageObject","url":"https://andyksaw.github.io/favicon.ico"}}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-2747125-3"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-2747125-3")</script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list-page{background:var(--theme)}.list-page:not(.dark)::-webkit-scrollbar-track{background:0 0}.list-page:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body class="type-posts kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="light",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=https://andyksaw.github.io accesskey=h title="andysaw (Alt + H)">andysaw</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://andyksaw.github.io/categories/ title=categories>categories</a></li><li><a href=https://andyksaw.github.io/tags/ title=tags>tags</a></li><li><a href=https://andyksaw.github.io/search/ title="search (Alt + /)" data-no-instant accesskey=/>search</a></li><li><a href=https://andyksaw.github.io/archives/ title=archive>archive</a></li></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><h1 class=post-title>Migrating to Fastlane (Part 1)</h1><div class=post-meta><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>January 6, 2022</span></span><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<span class=post-tags><a href=https://andyksaw.github.io/tags/ios/>ios</a><a href=https://andyksaw.github.io/tags/fastlane/>fastlane</a><a href=https://andyksaw.github.io/tags/app-store-connect/>app store connect</a><a href=https://andyksaw.github.io/tags/api-key/>api key</a></span></span><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>5 min</span></span></div></header><div class="toc side right"><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><ul><li><a href=#the-roadmap aria-label="The Roadmap">The Roadmap</a></li></ul><li><a href=#part-1---app-store-connect-key aria-label="Part 1 - App Store Connect Key">Part 1 - App Store Connect Key</a><ul><li><a href=#credentials-a-world-of-pain aria-label="Credentials: A World of Pain">Credentials: A World of Pain</a></li><li><a href=#private-key-the-better-way aria-label="Private Key: The Better Way">Private Key: The Better Way</a><ul><li><a href=#generating-the-key aria-label="Generating the Key">Generating the Key</a></li><li><a href=#using-the-key aria-label="Using the Key">Using the Key</a></li></ul></li><li><a href=#cicd aria-label=CI/CD>CI/CD</a><ul><li><a href=#cant-you-inline-the-is_ci aria-label="Can&amp;rsquo;t you inline the is_ci?">Can&rsquo;t you inline the <code>is_ci</code>?</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><p>App releases, app distribution and general day-to-day development is full of laborious, manual tasks that squander our time. For iOS developers, Fastlane is an invaluable tool that can help automate away most of this.</p><p>It&rsquo;s super easy to integrate into your workflow - that is, unless you find yourself with an app that has already seen multiple, manually-performed releases. I found myself in said situation recently, banging my head in frustration at the lack of documentation regarding this. Fastlane is simple if you add it in from the beginning (and most guides assume you&rsquo;ll be doing so), but full of landmines later if you don&rsquo;t.</p><p>This series of posts outlines the process I went through and the various caveats I discovered along the way. By the end of it, we&rsquo;ll have an automated app-release pipeline that we can be proud of.</p><h2 id=the-roadmap>The Roadmap<a hidden class=anchor aria-hidden=true href=#the-roadmap>¬∂</a></h2><ul><li>Part 1 - <a href=/posts/migrate-to-fastlane-1-api-key/>App Store Connect API Key for authentication</a></li><li>Part 2 - Storing certificates/profiles in a GCP Bucket</li><li>Part 3 - Reusing existing certificates, profiles and keys</li><li>Part 4 - Migrating to manual app signing</li><li>Part 5 - Provisioning Profile device list</li><li>Part 6 - Uploading to TestFlight</li><li>Part 7 - Reducing secrets sprawl</li></ul><hr><h1 id=part-1---app-store-connect-key>Part 1 - App Store Connect Key<a hidden class=anchor aria-hidden=true href=#part-1---app-store-connect-key>¬∂</a></h1><p>We&rsquo;ll start off with the lowest hanging fruit: switching our API authentication to using a private key.</p><p>Any operation performed by Fastlane that involves the App Store (eg. submitting to TestFlight, releasing the app) or certificates/profiles (eg. downloading, updating, etc) requires authentication to prove that you are allowed to do so.</p><h2 id=credentials-a-world-of-pain>Credentials: A World of Pain<a hidden class=anchor aria-hidden=true href=#credentials-a-world-of-pain>¬∂</a></h2><p>If you&rsquo;ve been releasing your app manually, you&rsquo;ll be familiar with logging-in to App Store Connect with your email address and password in the browser.</p><p>Fastlane emulates that (cookie-based web session) authentication by default, using an unofficial version of the App Store Connect API. Performance and stability reasons aside, it is <strong>not recommended due to enforced Two Factor Authentication</strong>. In other words, the app owner&rsquo;s account must have (Apple&rsquo;s) 2FA enabled. If you are not said person and need to perform an app release, you will need to pester them often for a generated 2FA code.</p><p>For the same reason, CI/CD will not be possible using this method as we can&rsquo;t (feasibly) input the ever-changing 2FA code.</p><p>Frustrating? Yes. Let&rsquo;s fix that first for our sanity.</p><h2 id=private-key-the-better-way>Private Key: The Better Way<a hidden class=anchor aria-hidden=true href=#private-key-the-better-way>¬∂</a></h2><p>The recommended approach is to use the official <a href=https://developer.apple.com/app-store-connect/api/>App Store Connect JSON API</a>, and authenticate using a JSON Web Token (JWT). All of that is taken care of by Fastlane under the hood, provided that we pass it a private key that can be used to generate said token.</p><p>More importantly, by using the official API we will not be prompted for a 2FA code.</p><h3 id=generating-the-key>Generating the Key<a hidden class=anchor aria-hidden=true href=#generating-the-key>¬∂</a></h3><p>A token can be generated on App Store Connect.</p><p>WIP</p><blockquote><p>‚ö†Ô∏è Your account must have the <strong>Admin</strong> role to generate a token (or even see a link to the page). The <strong>App Owner</strong> role is not sufficient.</p></blockquote><blockquote><p>ü§Ø App Store Connect occasionally has weird caching issues. If your role was just updated to Admin but you still don&rsquo;t see the tab to create the token, try logout of App Store Connect and restart the browser.</p></blockquote><p>Let&rsquo;s download the <code>.p8</code> key file. Assuming your Fastlane files are stored in a <code>fastlane</code> folder, we should place the key in the parent of this folder. You can actually put it wherever you like, but for simplicity sake we&rsquo;ll store it like so:</p><pre tabindex=0><code>app/
‚îú‚îÄ‚îÄ app_store_connect_api_key.p8
‚îî‚îÄ‚îÄ fastlane/
    ‚îî‚îÄ‚îÄ Fastfile
</code></pre><p><strong>Do not commit the key to your repository</strong>, and be sure to add it to your <code>.gitignore</code> file.</p><p>As with any private key or token, you must take care who has access to it, as it grants the holder admin permissions to the API.</p><h3 id=using-the-key>Using the Key<a hidden class=anchor aria-hidden=true href=#using-the-key>¬∂</a></h3><p>From there it&rsquo;s a matter of calling the <code>app_store_connect_api_key</code> action in your <code>Fastfile</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=hl><span class=lnt>2
</span></span><span class=hl><span class=lnt>3
</span></span><span class=hl><span class=lnt>4
</span></span><span class=hl><span class=lnt>5
</span></span><span class=hl><span class=lnt>6
</span></span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>lane</span> <span class=ss>:beta</span> <span class=k>do</span> <span class=o>|</span><span class=n>options</span><span class=o>|</span>
</span></span><span class="line hl"><span class=cl>  <span class=n>app_store_connect_api_key</span><span class=p>(</span>
</span></span><span class="line hl"><span class=cl>    <span class=ss>key_id</span><span class=p>:</span> <span class=no>ENV</span><span class=o>[</span><span class=s2>&#34;ASC_API_KEY_ID&#34;</span><span class=o>]</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>    <span class=ss>issuer_id</span><span class=p>:</span> <span class=no>ENV</span><span class=o>[</span><span class=s2>&#34;ASC_API_ISSUER_ID&#34;</span><span class=o>]</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>    <span class=ss>key_filepath</span><span class=p>:</span> <span class=s2>&#34;app_store_connect_api_key.p8&#34;</span>
</span></span><span class="line hl"><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>upload_to_testflight</span> <span class=c1># This action needs the token</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>Anything that requires interaction with App Store Connect (eg. TestFlight, registering devices with match, generating certs with match), will require a call to the <code>app_store_connect_api_key</code> action first.</p><p>The action will return a dictionary/hash map containing the JWT Token. Technically we could pass the returned value as a parameter to each action that requires the token, but I find that totally unnecessary. The action automatically puts the key into the context, so <strong>you don‚Äôt need to do anything further</strong>.</p><p>There&rsquo;s many approaches to how you can do this. Personally, I prefer to create a lane for injecting the key and switch to that lane when another lane requires the key.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=hl><span class=lnt>10
</span></span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>lane</span> <span class=ss>:setup_app_store_connect_key</span> <span class=k>do</span> <span class=o>|</span><span class=n>options</span><span class=o>|</span>
</span></span><span class=line><span class=cl>  <span class=n>app_store_connect_api_key</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=ss>key_id</span><span class=p>:</span> <span class=no>ENV</span><span class=o>[</span><span class=s2>&#34;ASC_API_KEY_ID&#34;</span><span class=o>]</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=ss>issuer_id</span><span class=p>:</span> <span class=no>ENV</span><span class=o>[</span><span class=s2>&#34;ASC_API_ISSUER_ID&#34;</span><span class=o>]</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=ss>key_filepath</span><span class=p>:</span> <span class=s2>&#34;app_store_connect_api_key.p8&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lane</span> <span class=ss>:beta</span> <span class=k>do</span> <span class=o>|</span><span class=n>options</span><span class=o>|</span>
</span></span><span class="line hl"><span class=cl>  <span class=n>setup_app_store_connect_key</span>
</span></span><span class=line><span class=cl>  <span class=n>upload_to_testflight</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>Great! We&rsquo;re now using the key for authentication when running Fastlane locally.</p><h2 id=cicd>CI/CD<a hidden class=anchor aria-hidden=true href=#cicd>¬∂</a></h2><p>On a GitHub Runner, we won‚Äôt have the <code>.p8</code> file since it‚Äôs not pushed to the repository, and assuming you&rsquo;re using GitHub Actions, we cannot upload the key file.</p><p>The solution is to store the contents of the key as a GitHub secret, and then inject it.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=hl><span class=lnt>4
</span></span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>app_store_connect_api_key</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=ss>key_id</span><span class=p>:</span> <span class=no>ENV</span><span class=o>[</span><span class=s2>&#34;ASC_API_KEY_ID&#34;</span><span class=o>]</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=ss>issuer_id</span><span class=p>:</span> <span class=no>ENV</span><span class=o>[</span><span class=s2>&#34;ASC_API_ISSUER_ID&#34;</span><span class=o>]</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>  <span class=ss>key_content</span><span class=p>:</span> <span class=no>ENV</span><span class=o>[</span><span class=s2>&#34;ASC_API_KEY_CONTENT&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=hl><span class=lnt>4
</span></span><span class=hl><span class=lnt>5
</span></span><span class=hl><span class=lnt>6
</span></span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Register new devices</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>fastlane ios register_new_devices</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>ASC_API_KEY_ID</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.ASC_API_KEY_ID }}</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>ASC_API_ISSUER_ID</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.ASC_API_ISSUER_ID }}</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>ASC_API_KEY_CONTENT</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.ASC_API_KEY_CONTENT }}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>That being said, we don&rsquo;t always want to have to inject the key contents. When running Fastlane on your own development machine you&rsquo;ll have the key as a file rather than as an environment variable.</p><p>Luckily, we can make use of the in-built <code>is_ci</code> action to check if we‚Äôre in a CI/CD environment.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=hl><span class=lnt> 4
</span></span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>key_id</span> <span class=o>=</span> <span class=no>ENV</span><span class=o>[</span><span class=s2>&#34;ASC_API_KEY_ID&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=n>issuer_id</span> <span class=o>=</span> <span class=no>ENV</span><span class=o>[</span><span class=s2>&#34;ASC_API_ISSUER_ID&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=k>if</span> <span class=n>is_ci</span>
</span></span><span class=line><span class=cl>  <span class=n>app_store_connect_api_key</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=ss>key_id</span><span class=p>:</span> <span class=n>key_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=ss>issuer_id</span><span class=p>:</span> <span class=n>issuer_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=ss>key_content</span><span class=p>:</span> <span class=no>ENV</span><span class=o>[</span><span class=s2>&#34;ASC_API_KEY_CONTENT&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=n>app_store_connect_api_key</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=ss>key_id</span><span class=p>:</span> <span class=n>key_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=ss>issuer_id</span><span class=p>:</span> <span class=n>issuer_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=ss>key_content</span><span class=p>:</span> <span class=s2>&#34;app_store_connect_api_key.p8&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=cant-you-inline-the-is_ci>Can&rsquo;t you inline the <code>is_ci</code>?<a hidden class=anchor aria-hidden=true href=#cant-you-inline-the-is_ci>¬∂</a></h3><p>Duplication is unideal, and you would think this could simplify it:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=ss>key_content</span><span class=p>:</span> <span class=n>is_ci</span> <span class=p>?</span> <span class=no>ENV</span><span class=o>[</span><span class=s2>&#34;ASC_API_KEY_CONTENT&#34;</span><span class=o>]</span> <span class=p>:</span> <span class=s2>&#34;app_store_connect_api_key.p8&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>But the <code>is_ci</code> is a Fastlane Action, and therefore has to be on its own line:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=k>if</span> <span class=n>is_ci</span>
</span></span><span class=line><span class=cl>  <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://andyksaw.github.io>andysaw</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n=""=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script>
<script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>(function(){const a="1"=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script></body></html>